---
title: pyqt5写2048小游戏
date: 2019-09-25 11:12:31
tags:
---



第一步：就是这样，这个运行一下啥结果没有，也没有啥错误和警告，这就是建立一个pyqt的应用
```
#!/usr/bin/python3
# -*- coding: utf-8 -*-

import sys
from PyQt5.QtWidgets import QApplication, QWidget


class Game(QWidget):
    def __init__(self):
        super().__init__()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    ex = Game();
    sys.exit(app.exec_())
```
第二步：让他显示一个窗口
```
#!/usr/bin/python3
# -*- coding: utf-8 -*-

import sys
from PyQt5.QtWidgets import QApplication, QWidget

class Game(QWidget):
    def __init__(self):
        super().__init__()
        self.initUI()

    def initUI(self):
        self.show()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    ex = Game();
    sys.exit(app.exec_())
```
然后：添加一个网格布局
```
#!/usr/bin/python3
# -*- coding: utf-8 -*-

import sys
from PyQt5.QtWidgets import QApplication, QWidget, QGridLayout

class Game(QWidget):
    def __init__(self):
        super().__init__()
        self.initUI()

    def initUI(self):
        grid = QGridLayout()
        self.setLayout(grid)
        self.show()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    ex = Game();
    sys.exit(app.exec_())
```
然后：在网格布局里循环添加标签，4*4的qlabel
```
#!/usr/bin/python3
# -*- coding: utf-8 -*-

import sys
from PyQt5.QtWidgets import QApplication, QWidget, QGridLayout, QLabel

ROW = 4
class Game(QWidget):
    def __init__(self):
        super().__init__()
        self.initUI()

    def initUI(self):
        grid = QGridLayout()
        for i in range(ROW ** 2):
            label = QLabel('0', self)
            label.setFixedHeight(80)
            label.setFixedWidth(80)
            grid.addWidget(label, i // ROW, i % ROW)

        self.setLayout(grid)
        self.show()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    ex = Game();
    sys.exit(app.exec_())
```
然后：添加开始的两个数字，2或者4
```
#!/usr/bin/evn python
# -*- coding: utf-8 -*-

import sys
import random

from PyQt5.QtGui import QIcon, QPalette, QColor, QFont
from PyQt5.QtWidgets import (QWidget, QGridLayout, QPushButton, QApplication, QLabel, QLineEdit, QTextEdit, QMessageBox, QLCDNumber)
from PyQt5.QtCore import Qt, QTimer, QDateTime, QDate, QTime

ROW =4
COL =4

NUM_MAP_COLOR = {
    '0': {
        'background': QColor(0xcdc1b4),
        'font': QColor(0xcdc1b4)
    },
    '2': {
        'background': QColor(0xeee4da),
        'font': QColor(0x776e65)
    },
    '4': {
        'background': QColor(0xede0c8),
        'font': QColor(0x776e65)
    },
    '8': {
        'background': QColor(0xf2b179),
        'font': QColor(0xffffff)
    },
    '16': {
        'background': QColor(0xf59563),
        'font': QColor(0xffffff)
    },
    '32': {
        'background': QColor(0xf67c5f),
        'font': QColor(0xffffff)
    },
    '64': {
        'background': QColor(0xf65e3b),
        'font': QColor(0xffffff)
    },
    '128': {
        'background': QColor(0xedcf72),
        'font': QColor(0xffffff)
    },
    '256': {
        'background': QColor(0xedcc61),
        'font': QColor(0xffffff)
    },
    '512': {
        'background': QColor(0xedc850),
        'font': QColor(0xffffff)
    },
    '1024': {
        'background': QColor(0xedc53f),
        'font': QColor(0xffffff)
    },
    '2048': {
        'background': QColor(0xedc22e),
        'font': QColor(0xffffff)
    }
}

class Game(QWidget):
    def __init__(self):
        super().__init__()
        self.initUI()

    def initUI(self):
        grid = QGridLayout()
        grid.setSpacing(10) #标签中间的空间
        self.labels = []
        self.palettes = []
        for i in range(ROW ** 2):
            #create label
            label = QLabel('0', self)
            label.setAlignment(Qt.AlignCenter) #居中显示
            label.setFixedWidth(80)
            label.setFixedHeight(80)
            label.setFont(QFont("Arial", 20, QFont.Bold)) #粗体
            grid.addWidget(label, i // ROW, i % ROW)
            self.labels.append(label)
            #create palette
            pe = QPalette()
            pe.setColor(QPalette.WindowText, NUM_MAP_COLOR['0']['font'])
            label.setAutoFillBackground(True) #设置背景充满，为设置背景颜色的必要条件
            pe.setColor(QPalette.Window, NUM_MAP_COLOR['0']['background'])
            label.setPalette(pe)
            self.palettes.append(pe)
        self.randomSetLabels(2)#添加开始的2个数字
        self.setLayout(grid)

        self.setGeometry(300, 300, 400, 400)
        self.setWindowTitle('2048 game')
        self.setWindowIcon(QIcon('2048.png'))
        self.show()

    def keyPressEvent(self, e):
        print('hello')
    
    def randomSetLabels(self, nums):
        empty_grids = self.getEmptyGrid()
        num_strs = '22244'
        for _ in range(nums): #_和i是一样的，临时变量之后不会再用
            num = random.choice(num_strs)  #从num_strs字符串里随机选数字
            label_index = random.choice(empty_grids)
            self.setTextAndColor(label_index, num, setIsMove=False)

    def getEmptyGrid(self):
        results = [index for index, labels in enumerate(self.labels) if labels.text() == '0']
        return results

    def setTextAndColor(self, index, num, setIsMove=True):
        if setIsMove:
            pre_text = self.labels[index].text()
            if pre_text != num:
                self.isMove = True

        self.labels[index].setText(num)
        self.palettes[index].setColor(QPalette.WindowText, NUM_MAP_COLOR[num]['font'])
        self.palettes[index].setColor(QPalette.Window, NUM_MAP_COLOR[num]['background'])
        self.labels[index].setPalette(self.palettes[index])

```